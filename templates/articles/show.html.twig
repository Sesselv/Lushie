{% extends 'base.html.twig' %}
{% block importmap %}
{{ importmap(["app", "comment", "burger"]) }}
{% endblock %}

{% block body %}
<section class="sec-article">
  <div class="container">
    <div class="article">
      <div class="user">
        {% set profilePhoto = article.user.media|first %}
        <img src="{{ profilePhoto ? '/uploads/users/' ~ profilePhoto.filePath : '/images/pp.png' }}"
          alt="{{ article.user.username }}" />
        <p class="username">{{ article.user.username }}</p>
      </div>

      <p class="dateTime">{{ article.createdAt|date('d/m/Y H:i') }}</p>

      <h1>{{ article.title }}</h1>

      <p>{{ article.content }}</p>

      {% for image in article.media %}
      <img class="article-img" src="/uploads/articles/{{ image.filePath }}" alt="{{ article.title }}" />
      {% endfor %}

<form  class="likes" action="{{ path('app_article_reaction', {id: article.id}) }}" method="post" style="display:inline;">
    <button type="submit" class="reaction-btn {{ article.reactions|filter(r => r.user == app.user)|length > 0 ? 'reacted' : '' }}">
                      <svg width="2rem" height="2rem" viewBox="0 0 24 24">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 
                             4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 
                             14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 
                             6.86-8.55 11.54L12 21.35z"/>
                </svg>

    </button>
    <span class="reaction-count">{{ article.reactions|length }}</span>

</form>

    </div>

<div class="comment-form">
    <h2>Commentaires</h2>
    
    {% if app.user %}
        {{ form_start(form) }}
        {{ form_widget(form.content, {'attr': {'class': 'comment-textarea', 'placeholder': 'Écrivez votre commentaire...'}}) }}
        <button type="submit">Envoyer</button>
        {{ form_end(form) }}
    {% else %}
        <p>Vous devez être <a href="{{ path('app_login') }}">connecté</a> pour laisser un commentaire.</p>
    {% endif %}
</div>

<div class="comment-section">
    <div class="comments-list">
        {% for comment in comments %}
<div class="comment">
    <div class="comment-top">
        <div class="user-info">
            {% set profilePhoto = comment.user.media|first %}
            <img src="{{ profilePhoto ? '/uploads/users/' ~ profilePhoto.filePath : '/images/pp.png' }}"
                 alt="{{ comment.user.username }}" width="50px" />
            <strong>{{ comment.user.username }}</strong>
        </div>

        <span>{{ comment.createdAt|date('d/m/Y') }}</span>

        {% if comment.user == app.user %}
            <form action="{{ path('app_comment_delete', {'id': comment.id}) }}" method="post" class="delete-comment-form">
                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ comment.id) }}">
                <button type="submit" onclick="return confirm('Voulez-vous vraiment supprimer ce commentaire ?');">Supprimer</button>
            </form>
        {% endif %}
    </div>

    <p class="comment-content">{{ comment.content }}</p>
</div>

        {% else %}
            <p>Aucun commentaire pour le moment.</p>
        {% endfor %}
    </div>
</div>
  </div>
  </div>
</section>
{% endblock %}